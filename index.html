<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .input-section {
            background: #f8f9ff;
            border: 2px solid #e3f2fd;
        }

        .results-section {
            background: #f1f8e9;
            border: 2px solid #c8e6c9;
            display: none;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #4facfe;
            padding-bottom: 10px;
        }

        .form-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .form-group label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .form-group input::placeholder {
            color: #999;
            font-style: italic;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn-add {
            background: #4caf50;
            color: white;
        }

        .btn-add:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-remove {
            background: #f44336;
            color: white;
            padding: 8px 12px;
            font-size: 14px;
        }

        .btn-remove:hover {
            background: #da190b;
        }

        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            margin: 20px auto;
            display: block;
            min-width: 200px;
        }

        .btn-calculate:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn-export {
            background: #ff9800;
            color: white;
            margin-left: 10px;
        }

        .btn-export:hover {
            background: #e68900;
        }

        .meters-list {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .meter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f5f5f5;
            border-radius: 6px;
            border-right: 4px solid #4facfe;
        }

        .meter-info {
            flex-grow: 1;
        }

        .meter-info strong {
            color: #333;
            font-size: 16px;
        }

        .meter-details {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .transformer-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #4facfe;
        }

        .breaker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .breaker-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #4facfe;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-balanced { background: #4caf50; }
        .progress-good { background: #8bc34a; }
        .progress-medium { background: #ff9800; }
        .progress-high { background: #f44336; }
        .progress-low { background: #4caf50; }
        .progress-overload { background: #ff5722; }

        .balance-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }

        .balance-excellent {
            background: #4caf50;
            color: white;
        }

        .balance-good {
            background: #8bc34a;
            color: white;
        }

        .balance-fair {
            background: #ff9800;
            color: white;
        }

        .balance-poor {
            background: #f44336;
            color: white;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .results-table th {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .results-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .results-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .results-table tr:hover {
            background: #e3f2fd;
            transition: background 0.3s;
        }

        .load-high { background-color: #ffebee !important; }
        .load-medium { background-color: #fff8e1 !important; }
        .load-low { background-color: #e8f5e8 !important; }

        .overloaded {
            background-color: #ff5722 !important;
            color: white !important;
            font-weight: bold;
        }

        .overloaded td {
            border-color: #d32f2f !important;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #4facfe;
        }

        .summary-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .summary-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #4facfe;
        }

        .meter-details-cell {
            text-align: right !important;
            padding: 15px !important;
            line-height: 1.8;
        }

        .meter-detail-item {
            display: inline-block;
            background: #f0f8ff;
            border: 2px solid #4facfe;
            border-radius: 8px;
            padding: 8px 12px;
            margin: 3px;
            font-weight: bold;
            color: #2c5aa0;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .meter-detail-item .count {
            font-size: 18px;
            color: #1976d2;
        }

        .meter-detail-item .multiply {
            font-size: 16px;
            color: #666;
            margin: 0 2px;
        }

        .meter-detail-item .capacity {
            font-size: 14px;
            color: #d32f2f;
        }

        .meter-type-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 5px;
        }

        .mixed-load-indicator {
            background: linear-gradient(45deg, #4caf50, #ff9800, #2196f3);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 5px;
        }

        .transformer-overload-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .transformer-safe {
            border-left-color: #28a745;
        }

        .transformer-warning {
            border-left-color: #ffc107;
        }

        .transformer-danger {
            border-left-color: #dc3545;
        }

        @media (max-width: 768px) {
            .form-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 15px;
            }
            
            .summary {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .breaker-grid {
                grid-template-columns: 1fr;
            }

            .meter-details-cell {
                text-align: center !important;
            }

            .meter-detail-item {
                display: block;
                margin: 5px 0;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>âš–ï¸ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
            <p>Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø°ÙƒÙŠ - Ø­Ø¯ Ø£Ù‚ØµÙ‰ 80% Ù„ÙƒÙ„ Ù…Ø­ÙˆÙ„</p>
        </div>

        <div class="content">
            <div class="section input-section">
                <h2>ğŸ“Š Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                
                <div class="form-group">
                    <div>
                        <label for="meterType">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯:</label>
                        <select id="meterType">
                                  <option value="C1">C1 - Ø³ÙƒÙ†ÙŠ Ø¹Ø§Ø¯ÙŠ (ÙÙ„Ù„ØŒ Ø´Ù‚Ù‚ØŒ Ø¯ÙˆØ¨Ù„ÙƒØ³...)</option>
                            <option value="C2">C2 - Ù…Ø­Ù„Ø§Øª ØªØ¬Ø§Ø±ÙŠØ©</option>
                            <option value="C3">C3 - Ø´Ù‚Ù‚ Ù…ÙØ±ÙˆØ´Ø© / Ø³ÙƒÙ† Ø¹Ù…Ø§Ù„</option>
                            <option value="C4">C4 - ÙÙ†Ø§Ø¯Ù‚</option>
                            <option value="C5">C5 - Ù…ÙˆÙ„Ø§Øª / Ù…Ø±Ø§ÙƒØ² ØªØ³ÙˆÙ‚</option>
                            <option value="C6">C6 - Ù…Ø·Ø§Ø¹Ù… / Ù…Ù‚Ø§Ù‡ÙŠ</option>
                            <option value="C7">C7 - Ù…ÙƒØ§ØªØ¨ (Ø­ÙƒÙˆÙ…ÙŠØ©/ØªØ¬Ø§Ø±ÙŠØ©)</option>
                            <option value="C8">C8 - Ù…Ø¯Ø§Ø±Ø³ / Ø­Ø¶Ø§Ù†Ø§Øª</option>
                            <option value="C9">C9 - Ù…Ø³Ø§Ø¬Ø¯</option>
                            <option value="C10">C10 - Ù…ÙŠØ²Ø§Ù†ÙŠÙ† ÙÙ†Ø¯Ù‚</option>
                            <option value="C11">C11 - Ø®Ø¯Ù…Ø§Øª Ù…Ø´ØªØ±ÙƒØ© ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ</option>
                            <option value="C12">C12 - Ù…Ø±Ø§ÙÙ‚ Ø¹Ø§Ù…Ø© (Ø­Ù…Ø§Ù…Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØºÙŠØ±Ù‡Ø§)</option>
                            <option value="C13">C13 - Ù…ÙˆØ§Ù‚Ù Ø³ÙŠØ§Ø±Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ©</option>
                            <option value="C14">C14 - Ù…ÙˆØ§Ù‚Ù Ø®Ø§Ø±Ø¬ÙŠØ©</option>
                            <option value="C15">C15 - Ø¥Ù†Ø§Ø±Ø© Ø´ÙˆØ§Ø±Ø¹</option>
                            <option value="C16">C16 - Ø­Ø¯Ø§Ø¦Ù‚ ÙˆÙ…ØªÙ†Ø²Ù‡Ø§Øª</option>
                            <option value="C17">C17 - Ø³Ø§Ø­Ø§Øª Ù…ÙØªÙˆØ­Ø©</option>
                            <option value="C18">C18 - Ù…Ø³ØªØ´ÙÙŠØ§Øª / Ù…Ø±Ø§ÙÙ‚ Ø·Ø¨ÙŠØ©</option>
                            <option value="C19">C19 - Ø¹ÙŠØ§Ø¯Ø§Øª Ø·Ø¨ÙŠØ©</option>
                            <option value="C20">C20 - Ø¬Ø§Ù…Ø¹Ø§Øª / Ù…Ø¹Ø§Ù‡Ø¯ Ø¹Ù„ÙŠØ§</option>
                            <option value="C21">C21 - ØµÙ†Ø§Ø¹Ø§Øª Ø®ÙÙŠÙØ©</option>
                            <option value="C22">C22 - ÙˆØ±Ø´ Ø¹Ù…Ù„</option>
                            <option value="C23">C23 - Ù…Ø®Ø§Ø²Ù† ØªØ¨Ø±ÙŠØ¯</option>
                            <option value="C24">C24 - Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª</option>
                            <option value="C25">C25 - Ù‚Ø§Ø¹Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø§Øª</option>
                            <option value="C26">C26 - Ù…Ù†Ø´Ø¢Øª ØªØ±ÙÙŠÙ‡ÙŠØ©</option>
                            <option value="C27">C27 - Ù…Ø²Ø§Ø±Ø¹ / Ù…Ù†Ø´Ø¢Øª Ø²Ø±Ø§Ø¹ÙŠØ©</option>
                            <option value="C28">C28 - Ù…Ø­Ø·Ø§Øª ÙˆÙ‚ÙˆØ¯</option>
                            <option value="C29">C29 - Ù…ØµØ§Ù†Ø¹ ÙƒØ¨Ø±Ù‰</option>
                        </select>
                    </div>
                    <div>
                        <label for="meterCount">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª:</label>
                        <input type="number" id="meterCount" min="1" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª">
                    </div>
                    <div>
                        <label for="meterCapacity">Ø³Ø¹Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (A):</label>
                        <select id="meterCapacity">
                        <option value="20">20A</option>
                            <option value="30">30A</option>
                            <option value="40">40A</option>
                            <option value="50">50A</option>
                            <option value="70">70A</option>
                            <option value="100">100A</option>
                            <option value="125">125A</option>
                            <option value="150">150A</option>
                            <option value="200">200A</option>
                            <option value="250">250A</option>
                            <option value="300">300A</option>
                            <option value="400">400A</option>
                            <option value="500">500A</option>
                            <option value="600">600A</option>
                             <option value="800">800A</option>
                              <option value="1600">1600A</option>
                               <option value="2500">2500A</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-add" onclick="addMeter()">â• Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                </div>

                <div class="meters-list" id="metersList">
                    <h3>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©:</h3>
                    <div id="metersContainer"></div>
                </div>

                <button class="btn btn-export" onclick="addSampleData()" style="margin: 10px;">ğŸ¯ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
                
                <button class="btn btn-calculate" onclick="calculateBalancedDistribution()">
                    âš–ï¸ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†
                </button>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù…Ø¹ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø°ÙƒÙŠ...</p>
                </div>
            </div>

            <div class="section results-section" id="resultsSection">
                <h2>ğŸ“ˆ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†</h2>
                
                <div class="summary-card">
                    <div class="summary-grid" id="summaryGrid"></div>
                </div>
                
                <div id="transformersSection"></div>
                
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø­ÙˆÙ„</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø·Ø¹</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø£Ø­Ù…Ø§Ù„</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</th>
                            <th>Ø§Ù„Ø­Ù…Ù„ (A)</th>
                            <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</th>
                            <th>Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙˆØ§Ø²Ù†</th>
                            <th>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody"></tbody>
                </table>

                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-export" onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                    <button class="btn btn-export" onclick="printResults()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                </div>
            </div>
        </div>
    </div>

    <script>














        // Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        const MAX_BREAKER_CAPACITY = 248;
        const TARGET_BREAKER_CAPACITY = 248; // Ø§Ù„Ù‡Ø¯Ù (80% Ù…Ù† 310)
        const TARGET_UTILIZATION = 75; // Ø§Ù„Ù‡Ø¯Ù 75% Ù„Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ
        const BALANCE_TOLERANCE = 15; // ØªÙØ§ÙˆØª Ù…Ù‚Ø¨ÙˆÙ„ Â±15%
        const MAX_TRANSFORMER_UTILIZATION = 80; // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 80% Ù„ÙƒÙ„ Ù…Ø­ÙˆÙ„

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª - Ù…Ø¹ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 80%
        const TRANSFORMER_TYPES = [
            { 
                capacity: 500, 
                maxCurrent: 721, 
                breakers: 4, 
                name: '500 KVA', 
                maxLoad: 576.80, // 80% Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
                safeLoad: 576.80, // 80% Ù…Ù† maxLoad
                minLoad: 216
            },
            { 
                capacity: 1000, 
                maxCurrent: 1443, 
                breakers: 8, 
                name: '1000 KVA', 
                maxLoad: 1154.40, 
                safeLoad: 1154.30, // 80% Ù…Ù† maxLoad
                minLoad: 433
            },
            { 
                capacity: 1500, 
                maxCurrent: 2164, 
                breakers: 10, 
                name: '1500 KVA', 
                maxLoad: 1731.20, 
                safeLoad: 1731.2, // 80% Ù…Ù† maxLoad
                minLoad: 800 
            }
        ];

        const meterTypeNames = {
            'C1': 'Ø³ÙƒÙ†ÙŠ Ø¹Ø§Ø¯ÙŠ', 'C2': 'Ù…Ø­Ù„Ø§Øª ØªØ¬Ø§Ø±ÙŠØ©', 'C3': 'Ø´Ù‚Ù‚ Ù…ÙØ±ÙˆØ´Ø©', 
            'C4': 'ÙÙ†Ø§Ø¯Ù‚', 'C5': 'Ù…ÙˆÙ„Ø§Øª', 'C6': 'Ù…Ø·Ø§Ø¹Ù…', 'C7': 'Ù…ÙƒØ§ØªØ¨', 
            'C8': 'Ù…Ø¯Ø§Ø±Ø³', 'C9': 'Ù…Ø³Ø§Ø¬Ø¯', 'C15': 'Ø¥Ù†Ø§Ø±Ø© Ø´ÙˆØ§Ø±Ø¹'
        };

        const demandFactors = {
                'C1': 0.5,   // Ø³ÙƒÙ†ÙŠ Ø¹Ø§Ø¯ÙŠ
            'C2': 0.6,   // Ù…Ø­Ù„Ø§Øª ØªØ¬Ø§Ø±ÙŠØ©
            'C3': 0.6,  // Ø´Ù‚Ù‚ Ù…ÙØ±ÙˆØ´Ø©
            'C4': 0.65,   // ÙÙ†Ø§Ø¯Ù‚
            'C5': 0.6,   // Ù…ÙˆÙ„Ø§Øª
            'C6': 0.6,  // Ù…Ø·Ø§Ø¹Ù…
            'C7': 0.6,  // Ù…ÙƒØ§ØªØ¨
            'C8': 0.7,   // Ù…Ø¯Ø§Ø±Ø³
            'C9': 0.8,   // Ù…Ø³Ø§Ø¬Ø¯
            'C10': 0.65, // Ù…ÙŠØ²Ø§Ù†ÙŠÙ† ÙÙ†Ø¯Ù‚
            'C11': 0.7,  // Ø®Ø¯Ù…Ø§Øª Ù…Ø´ØªØ±ÙƒØ©
            'C12': 0.65,  // Ù…Ø±Ø§ÙÙ‚ Ø¹Ø§Ù…Ø©
            'C13': 0.7,  // Ù…ÙˆØ§Ù‚Ù Ø¯Ø§Ø®Ù„ÙŠØ©
            'C14': 0.8, // Ù…ÙˆØ§Ù‚Ù Ø®Ø§Ø±Ø¬ÙŠØ©
            'C15': 0.8,  // Ø¥Ù†Ø§Ø±Ø© Ø´ÙˆØ§Ø±Ø¹
            'C16': 0.7,  // Ø­Ø¯Ø§Ø¦Ù‚
            'C17': 0.8,  // Ø³Ø§Ø­Ø§Øª Ù…ÙØªÙˆØ­Ø©
            'C18': 0.7, // Ù…Ø³ØªØ´ÙÙŠØ§Øª
            'C19': 0.6,  // Ø¹ÙŠØ§Ø¯Ø§Øª
            'C20': 0.7, // Ø¬Ø§Ù…Ø¹Ø§Øª
            'C21': 0.8,  // ØµÙ†Ø§Ø¹Ø§Øª Ø®ÙÙŠÙØ©
            'C22': 0.8, // ÙˆØ±Ø´ Ø¹Ù…Ù„
            'C23': 0.8,  // Ù…Ø®Ø§Ø²Ù† ØªØ¨Ø±ÙŠØ¯
            'C24': 0.6,  // Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
            'C25': 0.7,  // Ù‚Ø§Ø¹Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø§Øª
            'C26': 0.7, // Ù…Ù†Ø´Ø¢Øª ØªØ±ÙÙŠÙ‡ÙŠØ©
            'C27': 0.8,  // Ù…Ø²Ø§Ø±Ø¹
            'C28': 0.6,  // Ù…Ø­Ø·Ø§Øª ÙˆÙ‚ÙˆØ¯
            'C29': 0.8   // Ù…ØµØ§Ù†Ø¹ ÙƒØ¨Ø±Ù‰
        };

        // ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø­Ù…Ø§Ù„ Ù„Ù„Ø®Ù„Ø· Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†
        const loadCategories = {
            'residential': ['C1', 'C3'],
            'commercial': ['C2', 'C4', 'C5', 'C6', 'C7'],
            'public': ['C8', 'C9'],
            'infrastructure': ['C15']
        };

        // Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù„Ù„ØªÙˆØ§Ø²Ù†
        const timePatterns = {
            'day': ['C2', 'C7', 'C8'],
            'night': ['C1', 'C3', 'C4', 'C6'],
            'mixed': ['C5', 'C9', 'C15']
        };

        let meters = [];
        let distributionResults = null;

        // Ø­Ø³Ø§Ø¨ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø­Ø³Ù†
        function calculateCoincidenceFactor(N, meterType) {
            if (meterType === 'C2') return 1;
            if (N === 1) return 1;
            const sqrtN = Math.sqrt(N);
            return (0.67 + (0.33 / sqrtN)) / 1.25;
        }

        function getCategoryForType(type) {
            for (let category in loadCategories) {
                if (loadCategories[category].includes(type)) {
                    return category;
                }
            }
            return 'mixed';
        }

        function getTimePatternForType(type) {
            for (let pattern in timePatterns) {
                if (timePatterns[pattern].includes(type)) {
                    return pattern;
                }
            }
            return 'mixed';
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø³Ø¨ Ø³Ø¹Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
        function getBreakerRequirementForMeter(meterCapacity) {
            switch(meterCapacity) {
                case 500:
                    return { requiredBreakers: 2, breakerType: 'standard' }; // Ù‚Ø§Ø·Ø¹ÙŠÙ† Ø¹Ø§Ø¯ÙŠÙŠÙ†
                case 600:
                    return { requiredBreakers: 2, breakerType: 'standard' }; // Ù‚Ø§Ø·Ø¹ÙŠÙ† Ø¹Ø§Ø¯ÙŠÙŠÙ†
                case 800:
                    return { requiredBreakers: 2, breakerType: 'standard' }; // Ù‚Ø§Ø·Ø¹ÙŠÙ† Ø¹Ø§Ø¯ÙŠÙŠÙ†
                case 1600:
                    return { requiredBreakers: 1, breakerType: '1600A' }; // Ù‚Ø§Ø·Ø¹ 1600 Ø£Ù…Ø¨ÙŠØ±
                case 2500:
                    return { requiredBreakers: 1, breakerType: '2500A' }; // Ù‚Ø§Ø·Ø¹ 2500 Ø£Ù…Ø¨ÙŠØ±
                default:
                    return { requiredBreakers: 1, breakerType: 'standard' }; // Ù‚Ø§Ø·Ø¹ Ø¹Ø§Ø¯ÙŠ Ù„Ù„Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø·Ø¹
        function findTransformerForBreaker(targetBreaker) {
            if (distributionResults && distributionResults.transformers) {
                for (let transformer of distributionResults.transformers) {
                    if (transformer.breakers.includes(targetBreaker)) {
                        return transformer;
                    }
                }
            }
            return null;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù‚Ø§Ø·Ø¹ Ø«Ø§Ù†ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ù…Ù„
        function findBestSecondBreaker(breakers, halfLoad, excludeBreaker) {
            let bestBreaker = null;
            let bestScore = -1;
            
            for (let breaker of breakers) {
                if (breaker === excludeBreaker) continue;
                
                if (breaker.load + halfLoad <= MAX_BREAKER_CAPACITY) {
                    // Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù†
                    const newUtilization = ((breaker.load + halfLoad) / MAX_BREAKER_CAPACITY) * 100;
                    const targetDiff = Math.abs(newUtilization - TARGET_UTILIZATION);
                    const score = Math.max(0, 100 - targetDiff);
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestBreaker = breaker;
                    }
                }
            }
            
            return bestBreaker;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù‚Ø§Ø·Ø¹ÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ† Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ù…Ù„ - Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        function findBestTwoBreakers(breakers, halfLoad) {
            const availableBreakers = breakers.filter(breaker => 
                !breaker.dedicated && breaker.load + halfLoad <= MAX_BREAKER_CAPACITY
            );
            
            if (availableBreakers.length < 2) {
                return []; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ø·Ø¹ÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ†
            }
            
            let bestPair = [];
            let bestScore = -1;
            
            // ØªØ¬Ø±Ø¨Ø© ÙƒÙ„ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…Ù…ÙƒÙ†Ø©
            for (let i = 0; i < availableBreakers.length; i++) {
                for (let j = i + 1; j < availableBreakers.length; j++) {
                    const breaker1 = availableBreakers[i];
                    const breaker2 = availableBreakers[j];
                    
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù‡Ø°Ø§ Ø§Ù„Ø²ÙˆØ¬
                    const score = calculatePairScore(breaker1, breaker2, halfLoad, breakers);
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestPair = [breaker1, breaker2];
                    }
                }
            }
            
            return bestPair;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø²ÙˆØ¬ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹
        function calculatePairScore(breaker1, breaker2, halfLoad, allBreakers) {
            let score = 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ÙƒÙ„ Ù‚Ø§Ø·Ø¹
            const newUtilization1 = ((breaker1.load + halfLoad) / MAX_BREAKER_CAPACITY) * 100;
            const newUtilization2 = ((breaker2.load + halfLoad) / MAX_BREAKER_CAPACITY) * 100;
            
            // Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† Ù…Ø¹ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ (75%)
            const targetDiff1 = Math.abs(newUtilization1 - TARGET_UTILIZATION);
            const targetDiff2 = Math.abs(newUtilization2 - TARGET_UTILIZATION);
            score += Math.max(0, 50 - targetDiff1) + Math.max(0, 50 - targetDiff2);
            
            // Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø§Ø·Ø¹ÙŠÙ† Ù†ÙØ³ÙŠÙ‡Ù…Ø§
            const balanceBetweenPair = Math.abs(newUtilization1 - newUtilization2);
            score += Math.max(0, 30 - balanceBetweenPair);
            
            // Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø¹Ø§Ù… Ù…Ø¹ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹
            const avgLoad = allBreakers.reduce((sum, b) => sum + b.load, 0) / allBreakers.length;
            const balanceDiff1 = Math.abs((breaker1.load + halfLoad) - avgLoad);
            const balanceDiff2 = Math.abs((breaker2.load + halfLoad) - avgLoad);
            score += Math.max(0, 20 - balanceDiff1/2) + Math.max(0, 20 - balanceDiff2/2);
            
            // ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ø§Ù„Ø£Ù‚Ù„ Ø§Ø²Ø¯Ø­Ø§Ù…Ø§Ù‹
            const totalMeters = breaker1.meters.length + breaker2.meters.length;
            if (totalMeters < 8) {
                score += 15;
            } else if (totalMeters > 12) {
                score -= 10;
            }
            
            // ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© (Ù„Ù„ØªÙ†Ø¸ÙŠÙ…)
            if (Math.abs(breaker1.number - breaker2.number) === 1) {
                score += 10;
            }
            
            return score;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ù‚Ø§Ø·Ø¹ÙŠÙ† Ù…Ù†Ø§Ø³Ø¨ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø­ÙˆÙ„
        function checkTwoBreakersAvailability(transformer, halfLoad) {
            const availableBreakers = transformer.breakers.filter(breaker => 
                breaker.load + halfLoad <= MAX_BREAKER_CAPACITY
            );
            
            return availableBreakers.length >= 2;
        }

        function addMeter() {
            const type = document.getElementById('meterType').value;
            const count = parseInt(document.getElementById('meterCount').value);
            const capacity = parseInt(document.getElementById('meterCapacity').value);

            if (!count || count <= 0) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª');
                return;
            }

            const demandFactor = demandFactors[type];
            const coincidenceFactor = calculateCoincidenceFactor(count, type);
            const cdlPerMeter = capacity * demandFactor;
            const totalCDL = count * cdlPerMeter * coincidenceFactor;

            const meterGroup = {
                id: Date.now(),
                type: type,
                typeName: meterTypeNames[type],
                count: count,
                capacity: capacity,
                demandFactor: demandFactor,
                coincidenceFactor: coincidenceFactor,
                cdlPerMeter: cdlPerMeter,
                totalCDL: totalCDL,
                category: getCategoryForType(type),
                timePattern: getTimePatternForType(type)
            };

            meters.push(meterGroup);
            updateMetersList();
            clearInputs();
            showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
        function updateMetersList() {
            const container = document.getElementById('metersContainer');
            
            if (meters.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯</p>';
                return;
            }

            container.innerHTML = meters.map(meter => `
                <div class="meter-item">
                    <div class="meter-info">
                        <strong>${meter.count} Ã— ${meter.typeName} (${meter.capacity}A)</strong>
                        <div class="meter-details">
                            Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø·Ù„Ø¨: ${meter.demandFactor.toFixed(3)} | 
                            Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ²Ø§Ù…Ù†: ${meter.coincidenceFactor.toFixed(3)} | 
                            Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${meter.totalCDL.toFixed(1)}A
                        </div>
                    </div>
                    <button class="btn btn-remove" onclick="removeMeter(${meter.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
            `).join('');
        }

        function removeMeter(id) {
            meters = meters.filter(meter => meter.id !== id);
            updateMetersList();
            showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯');
        }

        function clearInputs() {
            document.getElementById('meterCount').value = '';
        }

        function addSampleData() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©ØŸ')) {
                meters = [];
                
                const sampleData = [
                    { type: 'C1', count: 35, capacity: 30 },
                    { type: 'C2', count: 25, capacity: 70 },
                    { type: 'C1', count: 30, capacity: 50 },
                    { type: 'C6', count: 15, capacity: 100 },
                    { type: 'C3', count: 20, capacity: 40 },
                    { type: 'C7', count: 18, capacity: 50 }
                ];

                sampleData.forEach(data => {
                    const demandFactor = demandFactors[data.type];
                    const coincidenceFactor = calculateCoincidenceFactor(data.count, data.type);
                    const cdlPerMeter = data.capacity * demandFactor;
                    const totalCDL = data.count * cdlPerMeter * coincidenceFactor;

                    meters.push({
                        id: Date.now() + Math.random(),
                        type: data.type,
                        typeName: meterTypeNames[data.type],
                        count: data.count,
                        capacity: data.capacity,
                        demandFactor: demandFactor,
                        coincidenceFactor: coincidenceFactor,
                        cdlPerMeter: cdlPerMeter,
                        totalCDL: totalCDL,
                        category: getCategoryForType(data.type),
                        timePattern: getTimePatternForType(data.type)
                    });
                });

                updateMetersList();
                showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Ø­Ù…Ù„ ÙƒØ¨ÙŠØ± Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©');
            }
        }

        // Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù…Ø¹ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
        function calculateBalancedDistribution() {
            if (meters.length === 0) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            
            setTimeout(() => {
                try {
                    const results = performBalancedDistributionMultiTransformer();
                    displayResults(results);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('resultsSection').style.display = 'block';
                    showSuccess(`ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†! Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª: ${results.transformers.length} - Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù†: ${results.balanceScore}%`);
                } catch (error) {
                    document.getElementById('loading').style.display = 'none';
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª: ' + error.message);
                }
            }, 1500);
        }













        // Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ù„ØªÙˆØ²ÙŠØ¹ Ø¹Ù„Ù‰ Ù…Ø­ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
        function performBalancedDistributionMultiTransformer() {
            const totalLoad = meters.reduce((sum, meter) => sum + meter.totalCDL, 0);
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ±Ø¯ÙŠØ© Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ù…Ù„
            const individualMeters = [];
            meters.forEach(meterGroup => {
                const cdlPerMeter = meterGroup.totalCDL / meterGroup.count;
                for (let i = 0; i < meterGroup.count; i++) {
                    individualMeters.push({
                        ...meterGroup,
                        id: `${meterGroup.id}_${i + 1}`,
                        cdl: cdlPerMeter
                    });
                }
            });

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ù…Ù„ (Ø§Ù„Ø£ÙƒØ¨Ø± Ø£ÙˆÙ„Ø§Ù‹)
            individualMeters.sort((a, b) => b.cdl - a.cdl);

            // ØªÙˆØ²ÙŠØ¹ Ø¹Ù„Ù‰ Ù…Ø­ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
            const transformers = distributeOnMultipleTransformers(individualMeters, totalLoad);
            
            // Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
            const balanceScore = calculateOverallBalanceScore(transformers);
            
            return {
                totalLoad: totalLoad,
                transformers: transformers,
                balanceScore: balanceScore,
                summary: calculateMultiTransformerSummary(transformers, totalLoad, balanceScore)
            };
        }

        function distributeOnMultipleTransformers(individualMeters, totalLoad) {
            const transformers = [];
            let remainingMeters = [...individualMeters];
            let transformerId = 1;

            while (remainingMeters.length > 0) {
                // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø­Ù…Ù„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                const remainingLoad = remainingMeters.reduce((sum, meter) => sum + meter.cdl, 0);
                const selectedTransformerType = selectOptimalTransformerForLoad(remainingLoad);
                
                const transformer = {
                    id: transformerId++,
                    type: selectedTransformerType,
                    assignedLoad: 0,
                    breakers: []
                };

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ù„Ù„Ù…Ø­ÙˆÙ„
                const requiredBreakers = Math.ceil(Math.min(remainingLoad, selectedTransformerType.safeLoad) / (MAX_BREAKER_CAPACITY * 0.75));
                const actualBreakers = Math.min(requiredBreakers, selectedTransformerType.breakers);

                for (let i = 1; i <= actualBreakers; i++) {
                    transformer.breakers.push({
                        id: i,
                        number: i,
                        load: 0,
                        meters: [],
                        utilizationPercent: 0,
                        meterTypes: new Set(),
                        categories: new Set(),
                        timePatterns: new Set()
                    });
                }

                // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ÙˆÙ„ (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 80%)
                const assignedMeters = [];
                let currentTransformerLoad = 0;

                for (let i = remainingMeters.length - 1; i >= 0; i--) {
                    const meter = remainingMeters[i];
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¯ÙˆÙ† ØªØ¬Ø§ÙˆØ² 80%
                    if (currentTransformerLoad + meter.cdl <= selectedTransformerType.safeLoad) {
                        assignedMeters.push(meter);
                        currentTransformerLoad += meter.cdl;
                        remainingMeters.splice(i, 1);
                    }
                }

                if (assignedMeters.length > 0) {
                    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ø¹Ù„Ù‰ Ù‚ÙˆØ§Ø·Ø¹ Ø§Ù„Ù…Ø­ÙˆÙ„
                    distributeMetersOnTransformer(transformer, assignedMeters);
                    transformer.assignedLoad = currentTransformerLoad;
                    transformers.push(transformer);
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ®ØµÙŠØµ Ø£ÙŠ Ø¹Ø¯Ø§Ø¯ØŒ Ù†ÙƒØ³Ø± Ø§Ù„Ø­Ù„Ù‚Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠØ©
                    break;
                }
            }

            // Ø¥Ø°Ø§ Ø¨Ù‚ÙŠØª Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ù†Ø­Ø§ÙˆÙ„ ØªÙˆØ²ÙŠØ¹Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (remainingMeters.length > 0) {
                distributeRemainingMeters(transformers, remainingMeters);
            }

            return transformers;
        }

        function selectOptimalTransformerForLoad(load) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ØµØºØ± Ù…Ø­ÙˆÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ø§Ù„Ø­Ù…Ù„ Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 80%
            for (let transformer of TRANSFORMER_TYPES) {
                if (load <= transformer.safeLoad) {
                    return transformer;
                }
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ù…Ù„ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ Ù†Ø£Ø®Ø° Ø£ÙƒØ¨Ø± Ù…Ø­ÙˆÙ„ Ù…ØªØ§Ø­
            return TRANSFORMER_TYPES[TRANSFORMER_TYPES.length - 1];
        }

         
         
         
         function distributeMetersOnTransformer(transformer, assignedMeters) {
    if (!Array.isArray(assignedMeters)) {
        console.error('assignedMeters Ù„ÙŠØ³Øª Ù…ØµÙÙˆÙØ©:', assignedMeters);
        return;
    }

    console.log(`ğŸ”§ Ø¨Ø¯Ø¡ ØªÙˆØ²ÙŠØ¹ ${assignedMeters.length} Ø¹Ø¯Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆÙ„ ${transformer.type.name}`);

    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ù…Ù„ (Ø§Ù„Ø£ÙƒØ¨Ø± Ø£ÙˆÙ„Ø§Ù‹)
    const sortedMeters = assignedMeters.sort((a, b) => b.cdl - a.cdl);

    // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø©
    const largeMeters = sortedMeters.filter(meter => meter.capacity >= 1600);
    const dualBreakerMeters = sortedMeters.filter(meter => meter.capacity >= 500 && meter.capacity < 1600);
    const regularMeters = sortedMeters.filter(meter => meter.capacity < 500);

    console.log(`ğŸ“Š ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª:
    - ÙƒØ¨ÙŠØ±Ø© (â‰¥1600A): ${largeMeters.length}
    - Ù…ØªÙˆØ³Ø·Ø© (500-1600A): ${dualBreakerMeters.length}
    - Ø¹Ø§Ø¯ÙŠØ© (<500A): ${regularMeters.length}`);

    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (â‰¥1600A) - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    largeMeters.forEach(meter => {
        const dedicatedBreaker = findEmptyBreaker(transformer.breakers);
        if (dedicatedBreaker) {
            addMeterToBreaker(dedicatedBreaker, meter, transformer.type);
            dedicatedBreaker.dedicated = true;
            dedicatedBreaker.dedicatedFor = `${meter.capacity}A`;
            console.log(`ğŸ”¥ Ø¹Ø¯Ø§Ø¯ ÙƒØ¨ÙŠØ± ${meter.capacity}A â†’ Ù‚Ø§Ø·Ø¹ ${dedicatedBreaker.number} (Ù…Ø®ØµØµ)`);
        } else {
            console.warn(`âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ø·Ø¹ ÙØ§Ø±Øº Ù„Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ¨ÙŠØ± ${meter.capacity}A`);
        }
    });

    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© (500-1600A) - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    dualBreakerMeters.forEach(meter => {
        const halfLoad = meter.cdl / 2;
        const availableBreakers = transformer.breakers.filter(breaker => 
            !breaker.dedicated && breaker.load + halfLoad <= MAX_BREAKER_CAPACITY
        );

        if (availableBreakers.length >= 2) {
            const bestPair = findBestTwoBreakers(availableBreakers, halfLoad);
            
            if (bestPair.length === 2) {
                addMeterToBreaker(bestPair[0], {
                    ...meter,
                    id: `${meter.id}_part1`,
                    cdl: halfLoad,
                    note: `Ø¬Ø²Ø¡ 1 Ù…Ù† Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A`
                }, transformer.type);
                
                addMeterToBreaker(bestPair[1], {
                    ...meter,
                    id: `${meter.id}_part2`,
                    cdl: halfLoad,
                    note: `Ø¬Ø²Ø¡ 2 Ù…Ù† Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A`
                }, transformer.type);
                
                console.log(`ğŸ”„ Ø¹Ø¯Ø§Ø¯ Ù…ØªÙˆØ³Ø· ${meter.capacity}A â†’ Ù‚Ø§Ø·Ø¹ ${bestPair[0].number} + Ù‚Ø§Ø·Ø¹ ${bestPair[1].number} (${halfLoad}A Ù„ÙƒÙ„ Ù…Ù†Ù‡Ù…Ø§)`);
            } else {
                console.warn(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A Ø¹Ù„Ù‰ Ù‚Ø§Ø·Ø¹ÙŠÙ†`);
            }
        } else {
            console.warn(`âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ø·Ø¹ÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ† Ù„Ù„Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A`);
        }
    });

    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (<500A) - Ù…Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    regularMeters.forEach(meter => {
        let bestBreaker = null;
        let bestScore = -1;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù‚Ø§Ø·Ø¹ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„
        let maxBreakerLoad;
        switch(transformer.type.capacity) {
            case 500:
                maxBreakerLoad = 144.20;
                break;
            case 1000:
                maxBreakerLoad = 144.30;
                break;
            case 1500:
                maxBreakerLoad = 173.12;
                break;
            default:
                maxBreakerLoad = MAX_BREAKER_CAPACITY; // 248 Ù„Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        }

        for (let breaker of transformer.breakers) {
            if (breaker.dedicated) continue;

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø¹Ø©
            if (breaker.load + meter.cdl <= maxBreakerLoad) {
                const score = calculateBreakerScore(breaker, meter, transformer.breakers, transformer.type);
                if (score > bestScore) {
                    bestScore = score;
                    bestBreaker = breaker;
                }
            }
        }

        if (bestBreaker) {
            addMeterToBreaker(bestBreaker, meter, transformer.type);
            console.log(`âœ… Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A â†’ Ù‚Ø§Ø·Ø¹ ${bestBreaker.number} (${bestBreaker.load.toFixed(2)}A/${maxBreakerLoad}A)`);
        } else {
            console.warn(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ù…Ù…ØªÙ„Ø¦Ø©`);
        }
    });

    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    console.log('âš–ï¸ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ...');
    optimizeBalance(transformer.breakers, transformer.type);
    
    console.log(`âœ… ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆÙ„ ${transformer.type.name}`);
}

         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         

        function distributeRemainingMeters(transformers, remainingMeters) {
            for (let meter of remainingMeters) {
                let assigned = false;
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ø£ÙŠ Ù…Ø­ÙˆÙ„ Ù„Ø¯ÙŠÙ‡ Ù…Ø³Ø§Ø­Ø©
                for (let transformer of transformers) {
                    const currentLoad = transformer.assignedLoad;
                    
                    if (currentLoad + meter.cdl <= transformer.type.safeLoad) {
                        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø§Ø·Ø¹ Ù…Ù†Ø§Ø³Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ÙˆÙ„
                        for (let breaker of transformer.breakers) {
                            if (breaker.load + meter.cdl <= MAX_BREAKER_CAPACITY) {
                                addMeterToBreaker(breaker, meter);
                                transformer.assignedLoad += meter.cdl;
                                assigned = true;
                                break;
                            }
                        }
                        
                        if (assigned) break;
                    }
                }
                
                // Ø¥Ø°Ø§ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ®ØµÙŠØµ Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŒ Ù†Ø¶ÙŠÙ Ù…Ø­ÙˆÙ„ Ø¬Ø¯ÙŠØ¯
                if (!assigned) {
                    const newTransformerType = selectOptimalTransformerForLoad(meter.cdl);
                    const newTransformer = {
                        id: transformers.length + 1,
                        type: newTransformerType,
                        assignedLoad: meter.cdl,
                        breakers: []
                    };

                    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø·Ø¹ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
                    newTransformer.breakers.push({
                        id: 1,
                        number: 1,
                        load: 0,
                        meters: [],
                        utilizationPercent: 0,
                        meterTypes: new Set(),
                        categories: new Set(),
                        timePatterns: new Set()
                    });

                    addMeterToBreaker(newTransformer.breakers[0], meter);
                    transformers.push(newTransformer);
                }
            }
        }

         
         
         
         
         function calculateBreakerScore(breaker, meter, allBreakers, transformerType) {
    let score = 0;
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù‚Ø§Ø·Ø¹ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„
    let maxBreakerLoad;
    switch(transformerType.capacity) {
        case 500:
            maxBreakerLoad = 144.00;
            break;
        case 1000:
            maxBreakerLoad = 144.30;
            break;
        case 1500:
            maxBreakerLoad = 173.12;
            break;
        default:
            maxBreakerLoad = MAX_BREAKER_CAPACITY; // 248 Ù„Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (Ù„Ø§ ØªØºÙŠÙŠØ± Ù‡Ù†Ø§)
    const meterRequirement = getBreakerRequirementForMeter(meter.capacity);
    
    // Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ù‚ÙˆØ§Ø·Ø¹ Ø®Ø§ØµØ© (1600A Ø£Ùˆ 2500A) - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    if (meterRequirement.breakerType === '1600A' || meterRequirement.breakerType === '2500A') {
        if (breaker.meters.length === 0) {
            score += 100;
        } else {
            score -= 50;
        }
        return score;
    }
    
    // Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª 500AØŒ 600AØŒ 800A Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ù‚Ø§Ø·Ø¹ÙŠÙ† - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    if (meterRequirement.requiredBreakers === 2) {
        const halfLoad = meter.cdl / 2;
        if (breaker.load + halfLoad <= MAX_BREAKER_CAPACITY) {
            score += 80;
        } else {
            score -= 30;
        }
        return score;
    }

    // Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (20-400A) - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const newUtilization = ((breaker.load + meter.cdl) / maxBreakerLoad) * 100;
    const targetDiff = Math.abs(newUtilization - TARGET_UTILIZATION);
    score += Math.max(0, 50 - targetDiff);

    // Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const avgLoad = allBreakers.reduce((sum, b) => sum + b.load, 0) / allBreakers.length;
    const balanceDiff = Math.abs((breaker.load + meter.cdl) - avgLoad);
    score += Math.max(0, 30 - balanceDiff);

    // Ù†Ù‚Ø§Ø· Ø§Ù„Ø®Ù„Ø· Ø§Ù„Ù…ØªÙ†ÙˆØ¹ - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    if (!breaker.categories.has(meter.category)) {
        score += 15;
    }
    if (!breaker.timePatterns.has(meter.timePattern)) {
        score += 10;
    }

    // ØªØ¬Ù†Ø¨ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù… - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    if (breaker.meters.length >= 6) {
        score -= 20;
    }

    return score;
}

         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
      function addMeterToBreaker(breaker, meter, transformerType = null) {
    const meterRequirement = getBreakerRequirementForMeter(meter.capacity);
    
    // Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (1600AØŒ 2500A) - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    if (meter.capacity >= 1600) {
        if (breaker.meters.length > 0) {
            console.warn(`âš ï¸ Ø§Ù„Ù‚Ø§Ø·Ø¹ ${breaker.number} ØºÙŠØ± ÙØ§Ø±Øº Ù„Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ¨ÙŠØ± ${meter.capacity}A`);
            return false;
        }
        
        breaker.meters.push({
            ...meter,
            note: `Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A - Ù‚Ø§Ø·Ø¹ Ù…Ø®ØµØµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„`
        });
        breaker.load = meter.cdl;
        breaker.dedicated = true;
        breaker.dedicatedFor = `${meter.capacity}A`;
        
        updateBreakerStats(breaker, transformerType);
        console.log(`âœ… ØªÙ… ØªØ®ØµÙŠØµ Ø§Ù„Ù‚Ø§Ø·Ø¹ ${breaker.number} Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ø¯Ø§Ø¯ ${meter.capacity}A (${meter.cdl}A)`);
        return true;
    }
    
    // Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø©
    breaker.meters.push(meter);
    breaker.load += meter.cdl;
    updateBreakerStats(breaker, transformerType);
    return true;
}











   
         

         
         
         function optimizeBalance(breakers, transformerType) {
    let improved = true;
    let iterations = 0;

    while (improved && iterations < 10) {
        improved = false;
        iterations++;

        // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹
        for (let i = 0; i < breakers.length; i++) {
            for (let j = i + 1; j < breakers.length; j++) {
                if (tryBalanceBreakers(breakers[i], breakers[j], transformerType)) {
                    improved = true;
                }
            }
        }
    }
}

         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         

        
        
        
        function tryBalanceBreakers(breaker1, breaker2, transformerType) {
    if (breaker1.meters.length === 0 || breaker2.meters.length === 0) return false;

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„
    let maxBreakerLoad = MAX_BREAKER_CAPACITY;
    if (transformerType) {
        switch(transformerType.capacity) {
            case 500:
                maxBreakerLoad = 144.0;
                break;
            case 1000:
                maxBreakerLoad = 144.40;
                break;
            case 1500:
                maxBreakerLoad = 173.12;
                break;
        }
    }

    const currentDiff = Math.abs(breaker1.load - breaker2.load);
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø²Ù†
    for (let meter1 of breaker1.meters) {
        for (let meter2 of breaker2.meters) {
            const newLoad1 = breaker1.load - meter1.cdl + meter2.cdl;
            const newLoad2 = breaker2.load - meter2.cdl + meter1.cdl;
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ­Ù‚Ù‚
            if (newLoad1 <= maxBreakerLoad && newLoad2 <= maxBreakerLoad) {
                const newDiff = Math.abs(newLoad1 - newLoad2);
                
                if (newDiff < currentDiff - 5) {
                    // ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
                    const meter1Index = breaker1.meters.indexOf(meter1);
                    const meter2Index = breaker2.meters.indexOf(meter2);
                    
                    breaker1.meters[meter1Index] = meter2;
                    breaker2.meters[meter2Index] = meter1;
                    
                    updateBreakerStats(breaker1, transformerType);
                    updateBreakerStats(breaker2, transformerType);
                    
                    return true;
                }
            }
        }
    }
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ù†Ù‚Ù„ Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø²Ù†
    if (breaker1.load > breaker2.load + 20) {
        return tryMoveMeterForBalance(breaker1, breaker2, transformerType);
    } else if (breaker2.load > breaker1.load + 20) {
        return tryMoveMeterForBalance(breaker2, breaker1, transformerType);
    }
    
    return false;
}

        
        
        
        
        
        
        
        
        
        

         
         
         
         
         
         
         
         
         
         function tryMoveMeterForBalance(heavyBreaker, lightBreaker, transformerType) {
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„
    let maxBreakerLoad = MAX_BREAKER_CAPACITY;
    if (transformerType) {
        switch(transformerType.capacity) {
            case 500:
                maxBreakerLoad = 576.80;
                break;
            case 1000:
                maxBreakerLoad = 1154.40;
                break;
            case 1500:
                maxBreakerLoad = 1154.40;
                break;
        }
    }

    let bestMeter = null;
    let bestImprovement = 0;
    
    for (let meter of heavyBreaker.meters) {
        if (lightBreaker.load + meter.cdl <= maxBreakerLoad) {
            const currentDiff = Math.abs(heavyBreaker.load - lightBreaker.load);
            const newHeavyLoad = heavyBreaker.load - meter.cdl;
            const newLightLoad = lightBreaker.load + meter.cdl;
            const newDiff = Math.abs(newHeavyLoad - newLightLoad);
            
            const improvement = currentDiff - newDiff;
            if (improvement > bestImprovement) {
                bestImprovement = improvement;
                bestMeter = meter;
            }
        }
    }
    
    if (bestMeter && bestImprovement > 10) {
        const meterIndex = heavyBreaker.meters.indexOf(bestMeter);
        heavyBreaker.meters.splice(meterIndex, 1);
        lightBreaker.meters.push(bestMeter);
        
        updateBreakerStats(heavyBreaker, transformerType);
        updateBreakerStats(lightBreaker, transformerType);
        
        return true;
    }
    
    return false;
}

         
         
         
         
         
         
         
         
         
         
         

        function updateBreakerStats(breaker, transformerType = null) {
    breaker.load = breaker.meters.reduce((sum, meter) => sum + meter.cdl, 0);
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø­Ø³Ø§Ø¨ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„
    let maxCapacity = MAX_BREAKER_CAPACITY; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    
    if (transformerType) {
        switch(transformerType.capacity) {
            case 500:
                maxCapacity = 576.80;
                break;
            case 1000:
                maxCapacity = 1154.40;
                break;
            case 1500:
                maxCapacity = 1154.40;
                break;
            default:
                maxCapacity = MAX_BREAKER_CAPACITY;
        }
    }
    
    breaker.utilizationPercent = (breaker.load / maxCapacity) * 100;
    
    breaker.meterTypes = new Set();
    breaker.categories = new Set();
    breaker.timePatterns = new Set();
    
    breaker.meters.forEach(meter => {
        breaker.meterTypes.add(meter.type);
        breaker.categories.add(meter.category);
        breaker.timePatterns.add(meter.timePattern);
    });
}


        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø§Ø·Ø¹ ÙØ§Ø±Øº
        function findEmptyBreaker(breakers) {
            return breakers.find(breaker => breaker.meters.length === 0);
        }

        function calculateOverallBalanceScore(transformers) {
            if (transformers.length === 0) return 0;

            let totalScore = 0;
            let totalWeight = 0;

            transformers.forEach(transformer => {
                const transformerScore = calculateTransformerBalanceScore(transformer);
                const weight = transformer.assignedLoad;
                totalScore += transformerScore * weight;
                totalWeight += weight;
            });

            return totalWeight > 0 ? totalScore / totalWeight : 0;
        }

        function calculateTransformerBalanceScore(transformer) {
            const activeBreakers = transformer.breakers.filter(b => b.meters.length > 0);
            if (activeBreakers.length === 0) return 0;

            let totalScore = 0;
            let maxScore = 0;

            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙˆØ§Ø²Ù† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            const utilizationValues = activeBreakers.map(b => b.utilizationPercent);
            const avgUtilization = utilizationValues.reduce((a, b) => a + b, 0) / utilizationValues.length;
            const utilizationStdDev = Math.sqrt(utilizationValues.reduce((sum, val) => sum + Math.pow(val - avgUtilization, 2), 0) / utilizationValues.length);
            
            // Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† (ÙƒÙ„Ù…Ø§ Ù‚Ù„ Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØŒ ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯Øª Ø§Ù„Ù†Ù‚Ø§Ø·)
            const balanceScore = Math.max(0, 100 - (utilizationStdDev * 2));
            totalScore += balanceScore * 0.4;
            maxScore += 40;

            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù…Ø«Ù„
            let optimalUsageScore = 0;
            activeBreakers.forEach(breaker => {
                const diff = Math.abs(breaker.utilizationPercent - TARGET_UTILIZATION);
                optimalUsageScore += Math.max(0, 100 - (diff * 2));
            });
            optimalUsageScore = optimalUsageScore / activeBreakers.length;
            totalScore += optimalUsageScore * 0.3;
            maxScore += 30;

            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ù„Ø£Ø­Ù…Ø§Ù„
            let diversityScore = 0;
            activeBreakers.forEach(breaker => {
                const categoryCount = breaker.categories.size;
                const timePatternCount = breaker.timePatterns.size;
                diversityScore += Math.min(100, (categoryCount + timePatternCount) * 25);
            });
            diversityScore = diversityScore / activeBreakers.length;
            totalScore += diversityScore * 0.2;
            maxScore += 20;

            // ØªÙ‚ÙŠÙŠÙ… Ø¹Ø¯Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø²Ø§Ø¦Ø¯
            const overloadPenalty = activeBreakers.filter(b => b.utilizationPercent > 100).length * 10;
            totalScore -= overloadPenalty;

            // ØªÙ‚ÙŠÙŠÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ (ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 80%)
            const transformerUtilization = (transformer.assignedLoad / transformer.type.safeLoad) * 100;
            if (transformerUtilization <= 80) {
                totalScore += 10; // Ù…ÙƒØ§ÙØ£Ø© Ù„Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø­Ø¯ 80%
            } else {
                totalScore -= (transformerUtilization - 80) * 2; // Ø¹Ù‚ÙˆØ¨Ø© Ù„Ù„ØªØ¬Ø§ÙˆØ²
            }

            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙØ§Ø¡Ø© ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹
            const efficiencyScore = (activeBreakers.length / transformer.type.breakers) * 100;
            totalScore += efficiencyScore * 0.1;
            maxScore += 10;

            return Math.max(0, Math.min(100, (totalScore / maxScore) * 100));
        }

        
        function calculateOverallEfficiency(transformers) {
            let totalUsedCapacity = 0;
            let totalAvailableCapacity = 0;

            transformers.forEach(transformer => {
                totalUsedCapacity += transformer.assignedLoad;
                totalAvailableCapacity += transformer.type.safeLoad;
            });

            return totalAvailableCapacity > 0 ? (totalUsedCapacity / totalAvailableCapacity) * 100 : 0;
        }

        function displayResults(results) {
            distributionResults = results;
            
            displaySummary(results.summary);
            displayTransformers(results.transformers);
            displayResultsTable(results.transformers);
        }

        function displaySummary(summary) {
            const summaryGrid = document.getElementById('summaryGrid');
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ù…Ù„ Ø¨Ù€ KVA
            const totalLoadKVA = (summary.totalLoad * 0.4 * 1.73).toFixed(1);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ transformers ÙˆØ§Ù„Ø­ØµÙˆ
            
            let transformerDisplay = '';
            let transformerDetails = '';
            
            if (distributionResults && distributionResults.transformers && distributionResults.transformers.length > 0) {
                // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø©
                const transformerCapacities = {};
                distributionResults.transformers.forEach(transformer => {
                    const capacity = transformer.type.capacity;
                    if (transformerCapacities[capacity]) {
                        transformerCapacities[capacity]++;
                    } else {
                        trfunction calculateMultiTransformerSummary(transformers, totalLoad, balanceScore) {
    let totalBreakers = 0;
    let totalMeters = 0;
    let overloadedBreakers = 0;
    let overloadedTransformers = 0;
    let maxUtilization = 0;
    let minUtilization = 100;
    let totalUtilization = 0;
    let utilizationCount = 0;

    // âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ± meters Ù…Ø¨Ø§Ø´Ø±Ø©
    if (meters && meters.length > 0) {
        totalMeters = meters.reduce((sum, meter) => sum + meter.count, 0);
    }

    transformers.forEach(transformer => {
        const activeBreakers = transformer.breakers.filter(b => b.meters.length > 0);
        totalBreakers += activeBreakers.length;
        
        activeBreakers.forEach(breaker => {
            if (breaker.utilizationPercent > 100) {
                overloadedBreakers++;
            }
            maxUtilization = Math.max(maxUtilization, breaker.utilizationPercent);
            minUtilization = Math.min(minUtilization, breaker.utilizationPercent);
            totalUtilization += breaker.utilizationPercent;
            utilizationCount++;
        });

        // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø­ÙˆÙ„ Ù„Ø­Ø¯ 80%
        const transformerUtilization = (transformer.assignedLoad / transformer.type.safeLoad) * 100;
        if (transformerUtilization > 100) {
            overloadedTransformers++;
        }
    });

    const avgUtilization = utilizationCount > 0 ? totalUtilization / utilizationCount : 0;

    return {
        totalTransformers: transformers.length,
        totalBreakers,
        totalMeters, // âœ… Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ù…ØªØºÙŠØ± meters
        totalLoad: totalLoad.toFixed(1),
        overloadedBreakers,
        overloadedTransformers,
        maxUtilization: maxUtilization.toFixed(1),
        minUtilization: minUtilization === 100 ? '0.0' : minUtilization.toFixed(1),
        avgUtilization: avgUtilization.toFixed(1),
        balanceScore: balanceScore.toFixed(1),
        efficiency: calculateOverallEfficiency(transformers).toFixed(1)
    };
}
ansformerCapacities[capacity] = 1;
                    }
                });
                
                // ØªÙƒÙˆÙŠÙ† Ù†Øµ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ù…Ø¶ØºÙˆØ·)
                transformerDisplay = Object.entries(transformerCapacities)
                                        .sort(([a], [b]) => parseInt(b) - parseInt(a)) // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø©
                    .map(([capacity, count]) => `<span style="display: inline-block; background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 4px; margin: 1px;">${count}x ${capacity} KVA</span>`)
                    .join(' ');
                
                // ØªÙƒÙˆÙŠÙ† ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ÙØµÙ„Ø© (Ù…ÙØµÙ„)
                transformerDetails = Object.entries(transformerCapacities)
                    .sort(([a], [b]) => parseInt(b) - parseInt(a)) // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø©
                    .map(([capacity, count]) => `${count}x ${capacity} KVA`)
                    .join('<br>');
            }
            
            summaryGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${summary.totalTransformers}</div>
                    <div>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.totalBreakers}</div>
                    <div>Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.totalMeters}</div>
                    <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.totalLoad}</div>
                    <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ù…Ù„ (Ø£Ù…Ø¨ÙŠØ±)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalLoadKVA}</div>
                    <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ù…Ù„ (KVA)</div>
                </div>
                ${transformerDetails ? `
                <div class="stat-card">
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª</div>
                    <div style="font-size: 12px; line-height: 1.6; text-align: center;">
                        ${transformerDetails}
                    </div>
                </div>
                ` : ''}
                <div class="stat-card ${summary.overloadedTransformers > 0 ? 'balance-poor' : 'balance-excellent'}">
                    <div class="stat-number">${summary.overloadedTransformers}</div>
                    <div>Ù…Ø­ÙˆÙ„Ø§Øª Ù…Ø­Ù…Ù„Ø© Ø²Ø§Ø¦Ø¯</div>
                </div>
                <div class="stat-card ${summary.overloadedBreakers > 0 ? 'balance-poor' : 'balance-excellent'}">
                    <div class="stat-number">${summary.overloadedBreakers}</div>
                    <div>Ù‚ÙˆØ§Ø·Ø¹ Ù…Ø­Ù…Ù„Ø© Ø²Ø§Ø¦Ø¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.balanceScore}%</div>
                    <div>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.efficiency}%</div>
                    <div>Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
                </div>
            `;
        }

        function displayTransformers(transformers) {
            const transformersSection = document.getElementById('transformersSection');
            
            transformersSection.innerHTML = transformers.map((transformer, index) => {
                const activeBreakers = transformer.breakers.filter(b => b.meters.length > 0);
                const transformerUtilization = (transformer.assignedLoad / transformer.type.safeLoad) * 100;
                const transformerStatus = getTransformerStatus(transformerUtilization);
                
                // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
                const dedicatedIcon = transformer.isDedicated ? 'ğŸ”¥ ' : 'ğŸ”Œ ';
                const dedicatedLabel = transformer.isDedicated ? ' (Ù…Ø®ØµØµ)' : '';
                const dedicatedStyle = transformer.isDedicated ? 'border: 3px solid #ff6600; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);' : '';
                
                return `
                    <div class="transformer-section ${transformerStatus.class}" style="${dedicatedStyle}">
                        <h3>${dedicatedIcon}Ø§Ù„Ù…Ø­ÙˆÙ„ ${index + 1}: ${transformer.type.name}${dedicatedLabel} ${transformerStatus.indicator}</h3>
                        ${transformer.isDedicated ? `
                            <div style="background: #ff6600; color: white; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-weight: bold;">
                                ğŸ”¥ Ù…Ø­ÙˆÙ„ Ù…Ø®ØµØµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ø¯Ø§Ø¯ ${transformer.dedicatedFor} - ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø·
                            </div>
                        ` : ''}
                        <div style="margin-bottom: 15px;">
                            <strong>Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${transformer.assignedLoad.toFixed(1)}A / ${transformer.type.safeLoad}A (Ø­Ø¯ 80%)
                            <br>
                            <strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong> ${transformerUtilization.toFixed(1)}% ${transformerUtilization > 100 ? 'âš ï¸ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­' : 'âœ… Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¢Ù…Ù†'}
                            <br>
                            <strong>Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong> ${activeBreakers.length} Ù…Ù† ${transformer.type.breakers}
                            ${transformer.isDedicated ? '<br><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙˆÙ„:</strong> Ù…Ø®ØµØµ Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©' : `<br><strong>Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙˆØ§Ø²Ù†:</strong> ${getBalanceIndicator(activeBreakers)}`}
                        </div>
                        ${transformerUtilization > 100 ? `
                            <div class="transformer-overload-warning">
                                âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ÙˆÙ„ ÙŠØ¹Ù…Ù„ Ø¨Ø£ÙƒØ«Ø± Ù…Ù† 100% Ù…Ù† Ø·Ø§Ù‚ØªÙ‡ Ø§Ù„Ø¢Ù…Ù†Ø©!
                            </div>
                        ` : ''}
                        <div class="breaker-grid">
                            ${activeBreakers.map(breaker => `
                                <div class="breaker-card" style="${breaker.dedicated ? 'border: 2px solid #ff6600; background: #fff8f0;' : ''}">
                                    <h4>âš¡ Ø§Ù„Ù‚Ø§Ø·Ø¹ ${breaker.number} ${breaker.dedicated ? '<span style="background: #ff6600; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">Ù…Ø®ØµØµ</span>' : getBalanceLabel(breaker.utilizationPercent)}</h4>
                                    <div><strong>Ø§Ù„Ø­Ù…Ù„:</strong> ${breaker.load.toFixed(1)}A / 310A</div>
                                    <div class="progress-bar">
                                        <div class="progress-fill ${getProgressClass(breaker.utilizationPercent)}" 
                                             style="width: ${Math.min((breaker.load / 310) * 100, 100)}%"></div>
                                    </div>
                                    <div><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong> ${((breaker.load / 310) * 100).toFixed(1)}%</div>
                                    <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª:</strong> ${breaker.meters.length}</div>
                                    ${breaker.dedicated ? 
                                        `<div><strong>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø·Ø¹:</strong> ${breaker.status}</div>` :
                                        `<div><strong>ØªÙ†ÙˆØ¹ Ø§Ù„Ø£Ø­Ù…Ø§Ù„:</strong> ${breaker.categories.size} ÙØ¦Ø§ØªØŒ ${breaker.timePatterns.size} Ø£Ù†Ù…Ø§Ø·</div>`
                                    }
                                    <div style="margin-top: 10px;">
                                        ${generateMeterDetailsHTML(breaker)}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getTransformerStatus(utilization) {
            if (utilization <= 70) {
                return { class: 'transformer-safe', indicator: '<span class="balance-indicator balance-excellent">Ù…Ù…ØªØ§Ø²</span>' };
            } else if (utilization <= 85) {
                return { class: 'transformer-safe', indicator: '<span class="balance-indicator balance-good">Ø¬ÙŠØ¯</span>' };
            } else if (utilization <= 95) {
                return { class: 'transformer-warning', indicator: '<span class="balance-indicator balance-fair">ØªØ­Ø°ÙŠØ±</span>' };
            } else if (utilization <= 100) {
                return { class: 'transformer-warning', indicator: '<span class="balance-indicator balance-good">Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ø¢Ù…Ù†</span>' };
            } else {
                return { class: 'transformer-danger', indicator: '<span class="balance-indicator balance-poor">Ø®Ø·Ø± - ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯</span>' };
            }
        }

        function getBalanceIndicator(breakers) {
            const utilizationValues = breakers.map(b => b.utilizationPercent);
            const avgUtilization = utilizationValues.reduce((a, b) => a + b, 0) / utilizationValues.length;
            const stdDev = Math.sqrt(utilizationValues.reduce((sum, val) => sum + Math.pow(val - avgUtilization, 2), 0) / utilizationValues.length);
            
            if (stdDev < 10) return '<span class="balance-indicator balance-excellent">Ù…Ù…ØªØ§Ø²</span>';
            if (stdDev < 20) return '<span class="balance-indicator balance-good">Ø¬ÙŠØ¯</span>';
            if (stdDev < 30) return '<span class="balance-indicator balance-fair">Ù…Ù‚Ø¨ÙˆÙ„</span>';
            return '<span class="balance-indicator balance-poor">ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</span>';
        }

        function getBalanceLabel(utilization) {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† utilization Ø±Ù‚Ù… ØµØ­ÙŠØ­
            const util = parseFloat(utilization);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù‚ÙŠÙ…Ø©
            if (isNaN(util) || util < 0) {
                return '<span class="balance-indicator balance-poor">âŒ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©</span>';
            }
            
            // ØªØµÙ†ÙŠÙ Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© (Ù…Ù† 310A)
            // Ø­ÙŠØ« Ø£Ù† utilization Ù‡Ùˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† 310A ÙˆÙ„ÙŠØ³ Ù…Ù† 248A
            
            if (util >= 70 && util <= 80) {
                return '<span class="balance-indicator balance-excellent">â­ ØªÙˆØ§Ø²Ù† Ù…Ø«Ø§Ù„ÙŠ</span>';
            }
            else if (util >= 60 && util < 70) {
                return '<span class="balance-indicator balance-good">âœ… Ø¬ÙŠØ¯</span>';
            }
            else if (util >= 50 && util < 60) {
                return '<span class="balance-indicator balance-fair">âš ï¸ Ù…Ù‚Ø¨ÙˆÙ„</span>';
            }
            else if (util < 50) {
                return '<span class="balance-indicator balance-poor">ğŸ“‰ Ù…Ù†Ø®ÙØ¶</span>';
            }
            else {
                return '<span class="balance-indicator balance-poor">ğŸ”´ Ù…Ø±ØªÙØ¹</span>';
            }
        }

        function getProgressClass(utilization) {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† 310A
            const utilizationFrom310 = utilization * (248 / 310);
            
            if (utilizationFrom310 <= 75) return 'progress-balanced';  // Ø£Ø®Ø¶Ø±
            if (utilizationFrom310 <= 85) return 'progress-good';      // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­  
            if (utilizationFrom310 > 95) return 'progress-high';       // Ø£Ø­Ù…Ø±
            return 'progress-medium';  // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
        }

        function displayResultsTable(transformers) {
            const resultsBody = document.getElementById('resultsBody');
            
            let tableRows = '';
            
            transformers.forEach((transformer, transformerIndex) => {
                const activeBreakers = transformer.breakers.filter(b => b.meters.length > 0);
                activeBreakers.forEach(breaker => {
                    const loadTypeIndicator = breaker.categories.size > 1 ? 
                        '<span class="mixed-load-indicator">Ù…Ø®ØªÙ„Ø·</span>' : '';
                    const balanceIndicator = getBalanceLabel(breaker.utilizationPercent);
                    
                    tableRows += `
                        <tr>
                            <td>Ø§Ù„Ù…Ø­ÙˆÙ„ ${transformerIndex + 1}<br><small>${transformer.type.name}</small></td>
                            <td>Ù‚Ø§Ø·Ø¹ ${breaker.number}</td>
                            <td>${loadTypeIndicator}${Array.from(breaker.categories).join(', ')}</td>
                            <td>${breaker.meters.length}</td>
                            <td>${breaker.load.toFixed(1)}A</td>
                            <td>${breaker.utilizationPercent.toFixed(1)}%</td>
                            <td>${balanceIndicator}</td>
                            <td>${generateMeterDetailsHTML(breaker)}</td>
                        </tr>
                    `;
                });
            });
            
            resultsBody.innerHTML = tableRows;
        }

        function generateMeterDetailsHTML(breaker) {
            const meterGroups = {};
            
            breaker.meters.forEach(meter => {
                const key = `${meter.type}_${meter.capacity}`;
                if (!meterGroups[key]) {
                    meterGroups[key] = {
                        type: meter.type,
                        typeName: meter.typeName,
                        capacity: meter.capacity,
                        count: 0,
                        totalCDL: 0,
                        notes: []
                    };
                }
                meterGroups[key].count++;
                meterGroups[key].totalCDL += meter.cdl;
                
                if (meter.note) {
                    meterGroups[key].notes.push(meter.note);
                }
            });

            return Object.values(meterGroups).map(group => {
                const specialNote = group.capacity >= 500 ? 
                    `<br><small style="color: #ff6600;">${group.capacity >= 1600 ? 'Ù‚Ø§Ø·Ø¹ Ù…Ø®ØµØµ' : 'Ù…ÙˆØ²Ø¹ Ø¹Ù„Ù‰ Ù‚Ø§Ø·Ø¹ÙŠÙ†'}</small>` : '';
                
                return `
                    <div class="meter-detail-item">
                        <span style="font-size: 16px; color: #1976d2;">${group.count}</span>
                        <span style="margin: 0 3px;">Ã—</span>
                        <span style="font-size: 14px; color: #d32f2f;">${group.capacity}A</span>
                        ${specialNote}
                        <br>
                        <small style="color: #666;">${group.typeName}</small>
                    </div>
                `;
            }).join('');
        }

        function exportToExcel() {
            if (!distributionResults) {
                showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            let csvContent = "Ø§Ù„Ù…Ø­ÙˆÙ„,Ø§Ù„Ù‚Ø§Ø·Ø¹,Ù†ÙˆØ¹ Ø§Ù„Ø£Ø­Ù…Ø§Ù„,Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª,Ø§Ù„Ø­Ù…Ù„ (A),Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (%),Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙˆØ§Ø²Ù†,ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª\n";
            
            distributionResults.transformers.forEach((transformer, transformerIndex) => {
                const activeBreakers = transformer.breakers.filter(b => b.meters.length > 0);
                activeBreakers.forEach(breaker => {
                    const meterTypes = Array.from(breaker.categories).join(' + ');
                    const balanceText = getBalanceText(breaker.utilizationPercent);
                    const meterDetails = breaker.meters.map(meter => 
                        `${meter.typeName} (${meter.capacity}A)`
                    ).join(' | ');
                    
                    csvContent += `"Ø§Ù„Ù…Ø­ÙˆÙ„ ${transformerIndex + 1} - ${transformer.type.name}",Ù‚Ø§Ø·Ø¹ ${breaker.number},"${meterTypes}",${breaker.meters.length},${breaker.load.toFixed(1)},${breaker.utilizationPercent.toFixed(1)},"${balanceText}","${meterDetails}"\n`;
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø®Øµ Ø§Ù„ØªÙˆØ§Ø²Ù†
            csvContent += `\nÙ…Ù„Ø®Øµ Ø§Ù„ØªÙˆØ§Ø²Ù†:\n`;
            csvContent += `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª,${distributionResults.summary.totalTransformers}\n`;
            csvContent += `Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù†,${distributionResults.balanceScore}%\n`;
            csvContent += `Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©,${distributionResults.summary.efficiency}%\n`;
            csvContent += `Ù…Ø­ÙˆÙ„Ø§Øª Ù…Ø­Ù…Ù„Ø© Ø²Ø§Ø¦Ø¯,${distributionResults.summary.overloadedTransformers}\n`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Ø§Ù„ØªÙˆØ²ÙŠØ¹_Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†_Ù…ØªØ¹Ø¯Ø¯_Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        function getBalanceText(utilization) {
            const diff = Math.abs(utilization - TARGET_UTILIZATION);
            if (diff <= 10) return 'Ù…ØªÙˆØ§Ø²Ù† Ù…Ù…ØªØ§Ø²';
            if (diff <= 20) return 'Ù…ØªÙˆØ§Ø²Ù† Ø¬ÙŠØ¯';
            if (diff <= 30) return 'Ù…ØªÙˆØ§Ø²Ù† Ù…Ù‚Ø¨ÙˆÙ„';
            return 'ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†';
        }

        function printResults() {
            if (!distributionResults) {
                showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù…Ø­ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1, h2, h3 { color: #333; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                        th { background-color: #4facfe; color: white; }
                        .balance-excellent { background-color: #4caf50; color: white; padding: 4px 8px; border-radius: 4px; }
                        .balance-good { background-color: #8bc34a; color: white; padding: 4px 8px; border-radius: 4px; }
                        .balance-fair { background-color: #ff9800; color: white; padding: 4px 8px; border-radius: 4px; }
                        .balance-poor { background-color: #f44336; color: white; padding: 4px 8px; border-radius: 4px; }
                        .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
                        .stat-card { border: 2px solid #4facfe; padding: 15px; text-align: center; border-radius: 8px; }
                        .transformer-summary { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; }
                        .warning { background-color: #fff3cd; border: 1px solid #ffc107; color: #856404; padding: 10px; border-radius: 4px; margin: 10px 0; }
                        .safe { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 10px; border-radius: 4px; margin: 10px 0; }
                    </style>
                </head>
                <body>
                    <h1>âš–ï¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù„Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù…Ø­ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©</h1>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> ${new Date().toLocaleDateString('ar-SA')}</p>
                    <p><strong>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</strong> ${distributionResults.balanceScore}%</p>
                    
                    <h2>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h2>
                    <div class="summary">
                        <div class="stat-card">
                            <h3>${distributionResults.summary.totalTransformers}</h3>
                            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª</p>
                        </div>
                        <div class="stat-card">
                            <h3>${distributionResults.summary.totalBreakers}</h3>
                            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹</p>
                        </div>
                        <div class="stat-card">
                            <h3>${distributionResults.summary.totalMeters}</h3>
                            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
                        </div>
                        <div class="stat-card">
                            <h3>${distributionResults.summary.efficiency}%</h3>
                            <p>Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</p>
                        </div>
                    </div>
                    
                    <h2>ğŸ”Œ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª</h2>
                    ${distributionResults.transformers.map((transformer, index) => {
                        const transformerUtilization = (transformer.assignedLoad / transformer.type.safeLoad) * 100;
                        const isOverloaded = transformerUtilization > 100;
                        
                        return `
                            <div class="transformer-summary">
                                <h3>Ø§Ù„Ù…Ø­ÙˆÙ„ ${index + 1}: ${transformer.type.name}</h3>
                                <div class="${isOverloaded ? 'warning' : 'safe'}">
                                    <strong>Ø§Ù„Ø­Ù…Ù„:</strong> ${transformer.assignedLoad.toFixed(1)}A / ${transformer.type.safeLoad}A<br>
                                    <strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong> ${transformerUtilization.toFixed(1)}%<br>
                                    <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${isOverloaded ? 'âš ï¸ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¢Ù…Ù† (100%)' : 'âœ… Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¢Ù…Ù†'}
                                </div>
                            </div>
                        `;
                    }).join('')}
                    
                    <h2>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†</h2>
                    ${document.getElementById('resultsTable').outerHTML}
                    
                    <h2>ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</h2>
                    <div style="margin: 20px 0;">
                        <p><strong>Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ø²Ø§Ø¦Ø¯:</strong> ${distributionResults.summary.overloadedTransformers} Ù…Ù† ${distributionResults.summary.totalTransformers}</p>
                        <p><strong>Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ø²Ø§Ø¦Ø¯:</strong> ${distributionResults.summary.overloadedBreakers} Ù…Ù† ${distributionResults.summary.totalBreakers}</p>
                        <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹:</strong> ${distributionResults.summary.avgUtilization}%</p>
                        <p><strong>Ø£Ù‚ØµÙ‰ Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong> ${distributionResults.summary.maxUtilization}%</p>
                        <p><strong>Ø£Ø¯Ù†Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong> ${distributionResults.summary.minUtilization}%</p>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
            
            showSuccess('ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-error';
            errorDiv.innerHTML = `âš ï¸ ${message}`;
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '20px';
            errorDiv.style.right = '20px';
            errorDiv.style.zIndex = '9999';
            errorDiv.style.maxWidth = '400px';
            errorDiv.style.borderRadius = '8px';
            errorDiv.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (document.body.contains(errorDiv)) {
                    document.body.removeChild(errorDiv);
                }
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'alert alert-success';
            successDiv.innerHTML = `âœ… ${message}`;
            successDiv.style.position = 'fixed';
            successDiv.style.top = '20px';
            successDiv.style.right = '20px';
            successDiv.style.zIndex = '9999';
            successDiv.style.maxWidth = '400px';
            successDiv.style.borderRadius = '8px';
            successDiv.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                if (document.body.contains(successDiv)) {
                    document.body.removeChild(successDiv);
                }
            }, 3000);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            updateMetersList();
            
            document.getElementById('meterCount').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addMeter();
                }
            });
        });
    </script>
</body>
</html>
